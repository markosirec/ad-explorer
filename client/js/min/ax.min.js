var AX={config:{base_url:"http://konverzija.com/ad-explorer/index.php/api/",response_format:"json",date_format:"%m/%d/%Y %H:%i"},call_stack:new Array({id:0,title:""}),buildList:function(e){$("#items").hide();$("#items").children().remove("li");var t={folder:$("#items-template li.folder").first(),file:$("#items-template li.file").first()};for(var n=0;n<e.length;n++){var r=e[n];var i=$(t[r.type].clone());i.attr({id:r.item_id,"data-type":r.type,"data-url":r.url});i.find(".title").html(r.title);i.find(".date").html(r.last_update_formated);i.find(".format").html(r.ad_type);$("#items").append(i)}$.event.trigger("listBuilt")},getData:function(e,t,n,r){$.event.trigger("beforeAjaxRequest");t=t===undefined?{}:t;t.format=t.format!==undefined?t.format:AX.config.response_format;t.date_format=t.date_format!==undefined?t.date_format:AX.config.date_format;$.ajax({url:e,type:"GET",dataType:"jsonp",data:t,success:function(e){$.event.trigger("afterAjaxRequest");if(e.error!==undefined&&r!==undefined)r(e);else if(e.error!==undefined)alert(e.error);else if(n!==undefined)n(e)},error:function(e,t,n){$.event.trigger("afterAjaxRequest");try{var r=$.parseJSON(e.responseText);if(r.error!==undefined)alert(r.error);else alert(n)}catch(i){alert(n)}}})},registerEventListeners:function(){$(document).on("listBuilt",AX.event_handlers.onListBuilt);$(document).on("beforeAjaxRequest",AX.event_handlers.onBeforeAjaxRequest);$(document).on("afterAjaxRequest",AX.event_handlers.onAfterAjaxRequest);var e=false;$("#items").on("touchend",function(t){if(!e)AX.event_handlers.onListTouch(t)});$("#items").on("touchmove",function(){e=true});$("#items").on("touchstart",function(){e=false});$("#back-button").on("touchend",AX.event_handlers.onBack);$("#refresh-button").on("touchend",AX.event_handlers.onRefresh)},event_handlers:{onListTouch:function(e){var t=0,n=false,r=$(e.target),i;while(!n&&t<8){if(r.prop("tagName")=="LI"){i=r;n=true}else r=$(r[0].parentElement);t++}if(i.attr("data-type")=="file"){var s=i.attr("data-url");if(s!==undefined)window.location=s;else alert("This item has a missing url!")}else{var o=AX.call_stack[AX.call_stack.length-1],u=parseInt(i.attr("id"));if(o.id!=u){AX.call_stack.push({id:u,title:i.find(".title").first().html()});$("#back-button").html(" .. / "+AX.call_stack[AX.call_stack.length-1].title)}AX.getData(AX.config.base_url+"items/"+i.attr("id")+"/children",{},AX.buildList)}},onBack:function(){AX.call_stack.pop();var e=AX.call_stack.length-1;var t=AX.call_stack[e].title;if(t!="")$("#back-button").html(" .. / "+t);else $("#back-button").html("");AX.getData(AX.config.base_url+"items/"+AX.call_stack[e].id+"/children",{},AX.buildList)},onRefresh:function(){AX.getData(AX.config.base_url+"items/"+AX.call_stack[AX.call_stack.length-1].id+"/children",{},AX.buildList)},onListBuilt:function(){$("#items").fadeIn("fast");if(AX.call_stack[AX.call_stack.length-1].id!==0)$("#back-button").show();else $("#back-button").hide()},onBeforeAjaxRequest:function(){$("#loading-screen").show()},onAfterAjaxRequest:function(){$("#loading-screen").hide()}}};(function(){AX.registerEventListeners();AX.getData(AX.config.base_url+"items/0/children",{},AX.buildList)})()